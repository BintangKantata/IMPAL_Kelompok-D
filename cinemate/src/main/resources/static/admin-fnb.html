<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin F&B Management</title>

  <style>
    body {
      background: radial-gradient(circle at top left, #0e1a20 0%, #11252d 40%, #0d1418 100%);
      color: white;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0 0 150px 0;
    }

    button {
            background: #22c55e;
            border: none;
            padding: 12px 18px;
            border-radius: 0.6rem;
            cursor: pointer;
            margin-top: 18px;
            font-weight: bold;
            color: white;
            transition: 0.2s;
            font-size: 14px;
        }

    h2 {
            font-size: 28px;
            margin-bottom: 25px;
            color: #ffffff;
            font-weight: 700;
    }

    /* ===== LAYOUT ===== */
        .admin-layout {
          display: flex;
          min-height: 100vh;
        }

    /* ===== SIDEBAR ===== */
    .sidebar {
          width: 220px;
          background: linear-gradient(to top, #0a1115 95%, transparent);
          backdrop-filter: blur(10px);
          box-shadow: 0 2px 10px rgba(0,0,0,0.3);
          padding: 20px;
          margin-right: 100px;

          position: sticky;
          top: 0;
          height: 200vh;
        }

        .sidebar h2 {
          margin-bottom: 30px;
          color: #5AC3E7;
        }

        .sidebar a {
          display: block;
          color: #cbd5f5;
          text-decoration: none;
          padding: 10px;
          border-radius: 6px;
          margin-bottom: 8px;
        }

        .sidebar a.active,
        .sidebar a:hover {
          background: #5AC3E7;
          color: #020617;
        }

    #admin-main {
      width: 1350px;
      background: rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 25px;
    }

    .content {bar
          flex: 1;
          padding: 30px;
        }

        .content-wrapper {
          width: 100%;
          margin: 0 auto;
        }

   .table-top {
          width: 100%;
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          margin-top: 30px;
        }

        .table-left {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .location-wrap {
          margin-bottom: 0; /* hilangkan turun ke bawah */
        }

        #locationSelect option {
          background-color: #5AC3E7;
          color: #ffffff;
        }


        .page-header button {
          padding: 10px 16px;
          border: none;
          background: #5AC3E7;
          color: #020617;
          border-radius: 6px;
          cursor: pointer;
          margin-bottom: 21px;
        }

        .page-header button:hover{
          color: #fff;
        }

        .page-actions {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        #searchInput {
          width: 220px;
          padding: 8px 12px;
          border-radius: 6px;
          border: 1px solid #2c3a40;
          background: rgba(255,255,255,0.18);
          color: #ffffff;
        }

        #searchInput::placeholder {
          color: #94a3b8;
        }

    select,
    input,
    textarea {
      background: rgba(255,255,255,0.15);
      border: 1px #0d0d0d;
      margin-left: 30px;
      color: white;
      border-radius: 0.6rem;
      padding: 0.55rem 0.75rem;
      width: 100%;
    }

    select {
      max-width: 280px;
    }

    /* ===== TABLE ===== */
    table {
          width: 100%;
          border-collapse: collapse;
          background: #fff;
          color: #0d0d0d;
          border-radius: 10px;
          overflow: hidden;
        }

        thead {
          background: #5AC3E7;
        }

        th, td {
          padding: 12px;
          border-bottom: 1px solid #1e293b;
        }

        /* PAKSA header table putih & rata kiri */
        table thead th {
          color: #ffffff !important;
          text-align: left !important;
        }

        table tbody td {
          color: #000000;
          text-align: left;
        }

        /* ===== ACTION BUTTON ===== */
        .edit-btn {
          background: #22c55e;
          border: none;
          color: #fff;
          padding: 6px 10px;
          margin-right: 5px;
          border-radius: 6px;
          cursor: pointer;
        }

        .edit-btn:hover {
          background: #46cf78;
        }

        .delete-btn {
          background: #fa3e48;
          border: none;
          color: #fff;
          padding: 6px 10px;
          margin-right: 5px;
          border-radius: 6px;
          cursor: pointer;
        }

        .delete-btn:hover {
          background: #ff4d56;
        }

    /* ===== PAGINATION INFO ===== */
    .pagination-wrapper {
          width: 100%;
          margin-top: 15px;

          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        #pagination {
          display: flex;
          flex-wrap: wrap;
        }


        #pagination button {
          margin: 0 4px;
          padding: 6px 10px;
          border: none;
          background: #020617;
          color: #cbd5f5;
          border-radius: 4px;
          cursor: pointer;
        }

        #pagination button:active {
          background: #5AC3E7;
          color: #020617;
        }

        #pagination button:hover {
          background: #5AC3E7;
          color: #020617;
        }

        #pagination button:disabled {
          opacity: 0.4;
        }

    /* ===== MODAL ===== */
    #modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #modal > div {
      background: rgba(20,32,38,0.95);
      color: black;
      padding: 1.5rem;
      width: 420px;
      border-radius: 1.2rem;
      border: 1px solid rgba(255,255,255,0.15);
    }

    #modal h3 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .qty-table {
      width: 70px;
      padding: 4px 6px;

      background: rgba(255,255,255,0.1);
      color: black;

      /* BORDER HITAM SELALU TERLIHAT */
      border: 1px solid #000;

      border-radius: 6px;
      text-align: left;
      margin-left: 0px;
      outline: none; /* hilangkan outline default */
    }


    #name, #description, #price, #type, #imageUrl {
      color: black;
      margin-left: 0px;
      border: 0.5px solid #000;
      width: 92%;
      outline: none;
      font-family: 'Poppins', sans-serif;
    }

    #modal #type {
      color: black;
      margin-left: 0px;
      border: 0.5px solid #000;
      width: 1000px;
      outline: none;
    }

    #modal #quantity {
      color: black;
      margin-left: 0px;
      border: 0.5px solid #000;
      outline: none;
      width: 92%;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 900px) {
      .layout-flex {
        flex-direction: column;
      }

      .sidebar-card {
        margin: 0 0 2rem 0;
        width: 100%;
      }

      .main-card {
        max-width: 100%;
        padding: 1.2rem;
      }
    }

    .admin-action-bar {
      display: flex;
      justify-content: space-between; /* kiri & kanan */
      align-items: center;
      width: 100%;
    }

    .admin-search {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 220px;
    }

}

  </style>
</head>

<body>

<div class="admin-layout">

    <aside class="sidebar">
        <h2>ADMIN</h2>
        <a href="admin-film.html">üé¨ Film</a>
        <a href="admin-fnb.html" class="active">üçø F&B</a>
    </aside>

    <main class="content">
        <div class="content-wrapper">

            <h1>F&B Management</h1>

      <!-- HEADER ACTION BAR -->
            <div class="page-header table-top">

                <!-- KIRI -->
                <div class="table-left">
                    <button onclick="openCreateModal()">
                        + Add F&B
                    </button>

                    <div class="mb-3 location-wrap">
                        <select id="locationSelect"></select>
                    </div>
                </div>

                <!-- KANAN -->
                <input
                        type="text"
                        id="searchInput"
                        placeholder="Search F&B..."
                        oninput="handleSearch()"
                        class="admin-search"
                >
            </div>


      <!-- TABLE -->
    <table>
      <thead>
      <tr>
        <th>No.</th>
        <th>Name</th>
        <th>Description</th>
        <th>Price</th>
        <th>Type</th>
        <th>Stock</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody id="fnbBody"></tbody>
    </table>

    <!-- PAGINATION -->
            <div class="pagination-wrapper">
                <span id="pageInfo"></span>
                <div id="pagination"></div>
            </div>

</div>

<!-- ================= MODAL ================= -->
<div id="modal" style="display:none;
     position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgba(0,0,0,0.5);">

  <div style="background:#fff;padding:20px;width:400px;
       margin:100px auto;border-radius:8px;">

    <h3 id="modalTitle">Create F&B</h3>

    <input type="hidden" id="itemId">

    <label>Name</label><br>
    <input id="name"><br><br>

    <label>Description</label><br>
    <textarea id="description"></textarea><br><br>

    <label>Price</label><br>
    <input type="number" id="price"><br><br>

    <label>Stock</label><br>
    <input type="number" id="quantity"><br><br>

      <label>Image URL</label><br>
      <input id="imageUrl" placeholder="https://example.com/image.jpg"><br><br>

      <label>Type</label><br>
      <select id="type">
          <option value="COMBO">Combo</option>
          <option value="DRINK">Drink</option>
          <option value="SNACK">Snack</option>
      </select><br><br>

    <div class="flex justify-end gap-2">
        <button class="edit-btn" onclick="saveItem()">Save</button>
      <button class="delete-btn" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>
    </main>
</div>

<script>
  /* ===============================
     GLOBAL STATE
  ================================ */
  let currentLocationId;
  let filteredData = [];
  let allData = [];
  let currentPage = 1;
  const rowsPerPage = 10;

  const nameInput = document.getElementById("name");

  const admin = localStorage.getItem('admin');

  if (!admin) {
    alert('Silakan login sebagai admin terlebih dahulu');
    window.location.href = 'admin-login.html';
  }

  /* ===============================
     LOAD LOCATIONS
  ================================ */
  async function loadLocations() {
    const res = await fetch('/api/admin/locations');
    const locations = await res.json();

    locationSelect.innerHTML = "";

    locations.forEach(l => {
      const opt = document.createElement("option");
      opt.value = l.id;
      opt.textContent = l.name;
      locationSelect.appendChild(opt);
    });

    if (locations.length) {
      currentLocationId = locations[0].id;
      loadFnb();
    }
  }

  /* ===============================
     LOAD FNB BY LOCATION
  ================================ */
  async function loadFnb() {
      const res = await fetch(`/api/fnb/location/${currentLocationId}`);
      allData = await res.json();

      filteredData = [...allData];
      currentPage = 1;
      renderTable();
    }


  /* ===============================
     RENDER TABLE
  ================================ */
  function renderTable() {
      const tbody = document.getElementById("fnbBody");
      tbody.innerHTML = "";

      if (!filteredData.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align:center;opacity:0.6">
              Tidak ada data
            </td>
          </tr>`;
        pagination.innerHTML = "";
        pageInfo.innerText = "No data";
        return;
      }

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      renderRows(pageData);
      renderPagination(filteredData.length);

      const totalPages = Math.ceil(filteredData.length / rowsPerPage);
      pageInfo.innerText = `Showing page ${currentPage} of ${totalPages}`;
    }


  /* ===============================
     RENDER ROWS
  ================================ */
  function renderRows(data) {
    const tbody = document.getElementById("fnbBody");
    tbody.innerHTML = "";

    data.forEach((item, index) => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${(currentPage - 1) * rowsPerPage + index + 1}</td>
        <td>${item.name}</td>
        <td>${item.description || "-"}</td>
        <td>Rp ${item.price.toLocaleString("id-ID")}</td>
        <td>${item.type}</td>
        <td>
          <input type="number" min="0" value="${item.quantity}"
                 class="qty-table"
                 onchange="updateQuantity(${item.id}, this.value)">
        </td>
        <td>
          <button class="edit-btn"
                  onclick="openEditModalById(${item.id})">
            Edit
          </button>
          <button class="delete-btn"
                  onclick="deleteItem(${item.id})">
            Delete
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    });
  }

  function handleSearch() {
      const keyword = searchInput.value.toLowerCase();

      filteredData = allData.filter(item =>
        item.name.toLowerCase().includes(keyword)
      );

      currentPage = 1;
      renderTable();
    }


  /* ===============================
     PAGINATION
  ================================ */
  function renderPagination(totalItems) {
    const totalPages = Math.ceil(totalItems / rowsPerPage);
    pagination.innerHTML = "";

    const prev = document.createElement("button");
    prev.innerText = "<";
    prev.disabled = currentPage === 1;
    prev.onclick = () => {
      currentPage--;
      renderTable();
    };
    pagination.appendChild(prev);

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.innerText = i;

      if (i === currentPage) {
        btn.style.background = "#5AC3E7";
        btn.style.color = "#23343B";
      }

      btn.onclick = () => {
        currentPage = i;
        renderTable();
      };

      pagination.appendChild(btn);
    }

    const next = document.createElement("button");
    next.innerText = ">";
    next.disabled = currentPage === totalPages;
    next.onclick = () => {
      currentPage++;
      renderTable();
    };
    pagination.appendChild(next);
  }

  /* ===============================
     UPDATE QUANTITY
  ================================ */
  async function updateQuantity(id, qty) {
    await fetch(`/api/fnb/${id}/quantity?quantity=${qty}`, {
      method: "PUT"
    });
  }

  /* ===============================
     MODAL
  ================================ */
  function openCreateModal() {
    resetForm();
    modalTitle.textContent = "Create F&B";
    modal.style.display = "block";
  }

  function openEditModalById(id) {
    const item = allData.find(i => i.id === id);
    if (!item) return;

    modalTitle.textContent = "Edit F&B";
    itemId.value = item.id;
    nameInput.value = item.name;
    description.value = item.description;
    price.value = item.price;
    type.value = item.type;
    quantity.value = item.quantity;
    imageUrl.value = item.imageUrl || ""

    modal.style.display = "block";
  }

  function closeModal() {
    modal.style.display = "none";
  }

  /* ===============================
     SAVE (CREATE / UPDATE)
  ================================ */
  async function saveItem() {
    const id = itemId.value;

    const payload = {
      name: nameInput.value.trim(),
      description: description.value,
      price: +price.value,
      type: type.value,
      quantity: +quantity.value,
      imageUrl: imageUrl.value.trim(),
      locationId: currentLocationId
    };

    await fetch(id ? `/api/fnb/${id}` : `/api/fnb`, {
      method: id ? "PUT" : "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    closeModal();
    loadFnb();
  }

  async function deleteItem(id) {
    if (!confirm("Delete this menu?")) return;

    await fetch(`/api/fnb/${id}`, { method: "DELETE" });
    loadFnb();
  }


  function resetForm() {
    itemId.value = "";
    name.value = "";
    description.value = "";
    price.value = "";
    quantity.value = "";
    imageUrl.value = "";
    type.value = "COMBO";
  }


  locationSelect.onchange = e => {
    currentLocationId = e.target.value;
    loadFnb();
  };

  loadLocations();
</script>

</body>
</html>
