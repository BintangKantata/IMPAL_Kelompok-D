<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booking Successful</title>
  <link href="dist/output.css" rel="stylesheet">

  <style>
    body {
                background: radial-gradient(circle at top left, #0e1a20 0%, #11252d 40%, #0d1418 100%);
                color: #fff;
                font-family: 'Montserrat', Arial, sans-serif;
                min-height: 100vh;
                padding: 2 rem
            }

        .ticket-box {
              background: rgba(0,0,0,0.15);
              border-radius: 1.5rem;
              padding: 2rem;
              max-width: 600px;
              margin: auto;
              margin-top: 40px;
              box-shadow: 0 4px 32px 0 rgba(0,0,0,0.10);
        }

        h2 {
          margin-top: 50px;
        }

        .poster {
          width: 240px;
          height: 340px;
          object-fit: cover;
          border-radius: 1.5rem;
          margin-right: 24px; /* hanya jarak, tidak ubah ukuran */
        }

        .row {
          display: flex;
          flex-direction: row;
          align-items: flex-start;
          gap: 24px; /* jarak rapi antar kolom */
        }

        .label {
          opacity: 0.6;
          margin-top: 6px;
        }

        .barcode-label {
          opacity: 0.6;
          margin-top: 6px;
          display: block;
          text-align: center;
        }


        .value {
          font-size: 18px;
          margin-bottom: 8px;
        }
        .button-home {
          margin-top: 25px;
          padding: 12px;
          width: 100%;
          background: #5AC3E7;
          color: black;
          font-size: 18px;
          font-weight: bold;
          border-radius: 10px;
          cursor: pointer;
          text-align: center;
          transition: color 0.2s ease;
        }
        .button-home:hover {
          background: #5AC3E7;
          color: white;
        }

        .barcode-wrapper{
          margin-top: 30px;
        }

        #ticketBarcode {
          margin-top: 8px;
          width: fit-content;
          margin-left: auto;
          margin-right: auto; /* center horizontal */
        }
  </style>
</head>

<body>

<h2 class="text-center text-3xl font-bold mt-4"></h2>

<div class="ticket-box">

  <div class="row">
    <img id="filmPoster" class="poster" src="" alt="Film Poster">

    <div>
      <div class="label">Film</div>
      <div id="filmTitle" class="value"></div>

      <div class="label">Location</div>
      <div id="locationName" class="value"></div>

      <div class="label">Schedule</div>
      <div id="scheduleTime" class="value"></div>

      <div class="label">Seats</div>
      <div id="seatList" class="value"></div>

      <div class="label">Total Paid</div>
      <div id="totalPaid" class="value font-bold text-green-400"></div>

      <div class="label">Booking ID</div>
      <div id="bookingIdDisplay" class="value"></div>
    </div>
  </div>

  <div class="barcode-wrapper">
    <div class="barcode-label">Ticket Barcode</div>
    <div id="ticketBarcode"></div>
  </div>


  <div class="button-home" onclick="goHome()">Back to Home</div>
</div>

<script>
    window.API = window.API || "/api";

  const params = new URLSearchParams(window.location.search);
  const bookingId =
    params.get("bookingId") ||
    localStorage.getItem("lastBookingId");

  if (!bookingId) {
    alert("Booking tidak ditemukan");
    window.location.href = "homepage.html";
  }

  async function loadTicket() {
    try {
      const res = await fetch(`${API}/bookings/${bookingId}/detail`);
      const data = await res.json();

      document.getElementById("filmTitle").textContent = data.filmTitle;
      document.getElementById("filmPoster").src =
        data.filmImage?.trim()
          ? data.filmImage
          : "https://via.placeholder.com/300x450?text=No+Image";

      document.getElementById("locationName").textContent = data.locationName;
      document.getElementById("scheduleTime").textContent =
        data.date + " " + data.time;

      document.getElementById("seatList").textContent = data.seats;
      document.getElementById("totalPaid").textContent =
        "Rp " + data.totalPrice.toLocaleString("id-ID");

      document.getElementById("bookingIdDisplay").textContent = data.bookingId;

      renderTicketBarcode(); // QR

    } catch (err) {
      console.error("Gagal memuat tiket:", err);
      alert("Gagal memuat tiket");
    }
  }

  loadTicket();

    function goHome() {
      localStorage.removeItem("selectedSeats");
      localStorage.removeItem("seatTotalPrice");
      localStorage.removeItem("scheduleId");
      localStorage.removeItem("fnbItems");
      localStorage.removeItem("fnbTotalPrice");
      window.location.href = "homepage.html";
    }
     function renderTicketBarcode() {
      const barcodeTargetUrl =
        "https://yt3.googleusercontent.com/0Wk1sRZ-V17WPh-QcpNo1GvZj8cqfgTy49JexcDODbN2q5Pgw4C-a9tiYUcOflsmO2ixdz2oGw=s160-c-k-c0x00ffffff-no-rj";

      const container = document.getElementById("ticketBarcode");
      container.innerHTML = ""; // clear jika reload

      new QRCode(container, {
        text: barcodeTargetUrl,
        width: 160,
        height: 160,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

</body>
</html>
